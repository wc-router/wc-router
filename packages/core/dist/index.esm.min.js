const t={tagNames:{route:"wc-route",routes:"wc-routes",outlet:"wc-outlet",layout:"wc-layout",layoutOutlet:"wc-layout-outlet"},enableShadowRoot:!1};function e(){return"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}function o(t){throw new Error(`[wc-router] ${t}`)}class a extends HTMLElement{_path="";_routeParentNode=null;_routeChildNodes=[];_routesNode=null;_uuid=e();_placeHolder=null;_childNodeArray=[];_isMadeArray=!1;_paramNames=[];_patternText="";_params={};_absolutePattern=null;_weight=-1;_absoluteWeight=0;_childIndex=0;constructor(){super(),this.hasAttribute("path")?this._path=this.getAttribute("path")||"":this.hasAttribute("index")?this._path="":o(`${t.tagNames.route} should have a "path" or "index" attribute.`);const e=this._path.split("/"),a=[];for(const t of e)t.startsWith(":")?(this._paramNames.push(t.substring(1)),a.push("([^\\/]+)"),this._weight+=1):(a.push(t),this._weight+=2);this._patternText=a.join("\\/")}get routeParentNode(){return this._routeParentNode}set routeParentNode(t){this._routeParentNode=t,t?(t.routeChildNodes.push(this),this._childIndex=t.routeChildNodes.length-1):(this.routesNode.routeChildNodes.push(this),this._childIndex=this.routesNode.routeChildNodes.length-1)}get routeChildNodes(){return this._routeChildNodes}get routesNode(){return this._routesNode||o(`${t.tagNames.route} has no routesNode.`),this._routesNode}set routesNode(t){this._routesNode=t}get path(){return this._path}get isRelative(){return!this._path.startsWith("/")}_checkParentNode(e,a){return this.isRelative&&!this._routeParentNode&&o(`${t.tagNames.route} is relative but has no parent route.`),!this.isRelative&&this._routeParentNode&&o(`${t.tagNames.route} is absolute but has a parent route.`),this.isRelative&&this._routeParentNode?e(this._routeParentNode):a()}get absolutePath(){return this._checkParentNode(t=>{const e=t.absolutePath;return e.endsWith("/")?e+this._path:e+"/"+this._path},()=>this._path)}get uuid(){return this._uuid}get placeHolder(){return this._placeHolder||o(`${t.tagNames.route} placeHolder is not set.`),this._placeHolder}set placeHolder(t){this._placeHolder=t}get rootElement(){return this.shadowRoot??this}get childNodeArray(){return this._isMadeArray||(this._childNodeArray=Array.from(this.rootElement.childNodes),this._isMadeArray=!0),this._childNodeArray}testPath(t){const e={},o=this._absolutePattern?.exec(t)??(this._absolutePattern=new RegExp(`^${this.absolutePatternText}$`)).exec(t);return o?(this.absoluteParamNames.forEach((t,a)=>{e[t]=o[a+1]}),{routes:this.routes,params:e}):null}get routes(){return this.routeParentNode?this.routeParentNode.routes.concat(this):[this]}get patternText(){return this._patternText}get absolutePatternText(){return this._checkParentNode(t=>{const e=t.absolutePatternText;return e.endsWith("\\/")?e+this._patternText:e+"\\/"+this._patternText},()=>this._patternText)}get params(){return this._params}get absoluteParamNames(){return this._checkParentNode(t=>[...t.absoluteParamNames,...this._paramNames],()=>[...this._paramNames])}get weight(){return this._weight}get absoluteWeight(){return this._absoluteWeight>=0?this._absoluteWeight:this._absoluteWeight=this._checkParentNode(t=>t.absoluteWeight+this._weight,()=>this._weight)}get childIndex(){return this._childIndex}show(t){this._params={};for(const e of this._paramNames)this._params[e]=t[e];const e=this.placeHolder.parentNode,o=this.placeHolder.nextSibling;for(const t of this.childNodeArray)o?e?.insertBefore(t,o):e?.appendChild(t)}hide(){this._params={};for(const t of this.childNodeArray)t.parentNode?.removeChild(t)}}const s=new Map;class n extends HTMLElement{_template;_uuid=e();_placeHolder=null;_name="";constructor(){super(),this._template=document.createElement("template"),this._name=this.getAttribute("name")||""}loadTemplateFromCache(t){return s.get(t)}async loadTemplateFromSource(e){try{const a=await fetch(e);a.ok||o(`${t.tagNames.layout} failed to fetch layout from source: ${e}, status: ${a.status}`);const n=await a.text();return s.set(e,n),n}catch(a){o(`${t.tagNames.layout} failed to load layout from source: ${e}, error: ${a}`)}}loadTemplateFromDocument(t){const e=document.getElementById(`${t}`);return e&&e instanceof HTMLTemplateElement?e.innerHTML:null}async loadTemplate(){const e=this.getAttribute("src"),o=this.getAttribute("layout");e&&o&&console.warn(`${t.tagNames.layout} have both "src" and "layout" attributes.`);const a=document.createElement("template");if(e)s.has(e)?a.innerHTML=s.get(e)||"":(a.innerHTML=await this.loadTemplateFromSource(e)||"",s.set(e,a.innerHTML));else if(o){const e=this.loadTemplateFromDocument(o);e?a.innerHTML=e:console.warn(`${t.tagNames.layout} could not find template with id "${o}".`)}return a}get uuid(){return this._uuid}get placeHolder(){return this._placeHolder}set placeHolder(t){this._placeHolder=t}get enableShadowRoot(){return!!this.hasAttribute("enable-shadow-root")||!this.hasAttribute("disable-shadow-root")&&t.enableShadowRoot}get name(){return this._name}}class r extends HTMLElement{_routesNode=null;_lastRoutes=[];constructor(){super(),t.enableShadowRoot&&this.attachShadow({mode:"open"})}get routesNode(){return this._routesNode}set routesNode(t){this._routesNode=t}get rootNode(){return this.shadowRoot?this.shadowRoot:this}showRouteContent(t,e){const o=new Set(t);for(const t of this._lastRoutes)o.has(t)||t.hide();const a=new Set(this._lastRoutes);for(const o of t)a.has(o)||o.show(e);this._lastRoutes=[...t]}connectedCallback(){}}function i(t,e,o,a,s){const n=o.concat(e),r=e.testPath(a);if(r)s.push(r);else for(const o of e.routeChildNodes)i(t,o,n,a,s)}async function l(e,o,a,s){const n=a.length>0?a[a.length-1]:null,r=document.createDocumentFragment(),i=Array.from(o.childNodes);for(const o of i)if(o.nodeType===Node.ELEMENT_NODE){let i=o,u=o;const h=u.tagName.toLowerCase();if(h===t.tagNames.route){const t=document.createDocumentFragment();for(const e of Array.from(u.childNodes))t.appendChild(e);const o=document.importNode(u,!0);customElements.upgrade(o),o.appendChild(t);const r=o;r.routesNode=e,r.routeParentNode=n,r.placeHolder=document.createComment(`@@route:${r.uuid}`),a.push(r),s.set(r.uuid,r),i=r.placeHolder,u=r}else if(h===t.tagNames.layout){const e=document.createDocumentFragment();for(const t of Array.from(u.childNodes))e.appendChild(t);const o=document.importNode(u,!0);customElements.upgrade(o),o.appendChild(e);const a=o,s=document.createElement(t.tagNames.layoutOutlet);s.layout=a,i=s,u=o}const d=await l(e,u,a,s);u.innerHTML="",u.appendChild(d),r.appendChild(i)}else r.appendChild(o);return r}async function u(t){const e=new Map,o=await l(t,t.template.content,[],e);return console.log(o),o}class h extends HTMLElement{static _instance=null;_outlet=null;_template=null;_routeChildNodes=[];constructor(){super(),h._instance&&o(`${t.tagNames.routes} can only be instantiated once.`),h._instance=this,console.log(this.rootElement.querySelectorAll("*"))}static get instance(){return h._instance||o(`${t.tagNames.routes} has not been instantiated.`),h._instance}static navigate(t){h.instance.navigate(t)}_getOutlet(){let e=document.querySelector(t.tagNames.outlet);return e||(e=document.createElement(t.tagNames.outlet),document.body.appendChild(e)),e}_getTemplate(){return this.querySelector("template")}get outlet(){return this._outlet||o(`${t.tagNames.routes} has no outlet.`),this._outlet}get template(){return this._template||o(`${t.tagNames.routes} has no template.`),this._template}get routeChildNodes(){return this._routeChildNodes}navigate(t){window.navigation?window.navigation.navigate(t):(history.pushState(null,"",t),this._applyRoute(t))}_applyRoute(e){const a=function(t,e){const o=[],a=t.routeChildNodes,s=[];for(const n of a)i(t,n,o,e,s);return s.sort((t,e)=>{const o=t.routes.at(-1),a=e.routes.at(-1),s=o.absoluteWeight-a.absoluteWeight;return 0!==s?-s:o.childIndex-a.childIndex}),s.length>0?s[0]:null}(this,e);a||o(`${t.tagNames.routes} No route matched for path: ${e}`),this.outlet.showRouteContent(a.routes,a.params)}_onNavigateFunc(t){if(!t.canIntercept||t.hashChange||null!==t.downloadRequest)return;const e=this;t.intercept({async handler(){const o=new URL(t.destination.url);e._applyRoute(o.pathname)}})}_onNavigate=this._onNavigateFunc.bind(this);async connectedCallback(){this._outlet=this._getOutlet(),this._outlet.routesNode=this,this._template=this._getTemplate(),this._template||o(`${t.tagNames.routes} should have a <template> child element.`);const e=await u(this);this._outlet.rootNode.appendChild(e),this._applyRoute(window.location.pathname),window.navigation?.addEventListener("navigate",this._onNavigate)}disconnectedCallback(){window.navigation?.removeEventListener("navigate",this._onNavigate)}get rootElement(){return this.shadowRoot??this}}class d extends HTMLElement{_layout=null;_isInitialized=!1;_layoutChildNodes=[];constructor(){super()}get layout(){return this._layout||o(`${t.tagNames.layoutOutlet} has no layout.`),this._layout}set layout(t){this._layout=t,this.setAttribute("name",t.name)}async initialize(){if(this._isInitialized)return;this._isInitialized=!0,this.layout.enableShadowRoot&&this.attachShadow({mode:"open"});const e=await this.layout.loadTemplate();if(this.shadowRoot){this.shadowRoot.appendChild(e.content.cloneNode(!0));for(const t of Array.from(this.layout.childNodes))this._layoutChildNodes.push(t),this.appendChild(t)}else{const o=e.content.cloneNode(!0),a=new Map;o.querySelectorAll("slot").forEach(e=>{const o=e.getAttribute("name")||"";a.has(o)?console.warn(`${t.tagNames.layoutOutlet} duplicate slot name "${o}" in layout template.`):a.set(o,e)});const s=new Map,n=document.createDocumentFragment();for(const t of Array.from(this.layout.childNodes)){if(this._layoutChildNodes.push(t),t instanceof Element){const e=t.getAttribute("slot")||"";if(e.length>0&&a.has(e)){s.has(e)||s.set(e,document.createDocumentFragment()),s.get(e)?.appendChild(t);continue}}n.appendChild(t)}for(const[t,e]of a){const o=s.get(t);o&&e.replaceWith(o)}const r=a.get("");r&&r.replaceWith(n),this.appendChild(o)}}async connectedCallback(){await this.initialize()}get rootNode(){return this.shadowRoot?this.shadowRoot:this}}customElements.get(t.tagNames.layout)||customElements.define(t.tagNames.layout,n),customElements.get(t.tagNames.layoutOutlet)||customElements.define(t.tagNames.layoutOutlet,d),customElements.get(t.tagNames.outlet)||customElements.define(t.tagNames.outlet,r),customElements.get(t.tagNames.route)||customElements.define(t.tagNames.route,a),customElements.get(t.tagNames.routes)||customElements.define(t.tagNames.routes,h);export{t as config};
//# sourceMappingURL=index.esm.min.js.map
